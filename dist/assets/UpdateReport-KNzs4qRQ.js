import{a as y,u as F,b as k,r as c,g as w,j as e,o as v,p as S}from"./index-CX1t2Ghj.js";import{c as C,d as Y,a as l,f as D,F as E,e as I,g as n,E as o}from"./index.esm--UJspW4j.js";import{D as L}from"./index.es-BMtkgi1A.js";/* empty css                         */import{D as q,c as m}from"./index-fIHkrhVy.js";import{p as R}from"./plus2-Cc0MLBo8.js";const U=()=>{const i=y(),p=F(),{reportId:d}=k(),[x,b]=c.useState(null),[u,f]=c.useState(!1),[g,h]=c.useState({reportId:"",reportName:"",reportCategory:"",reportSource:"",reportYear:null,reportSummary:"",reportLink:"",pdf:""});c.useEffect(()=>{(async()=>{if(d)try{const{payload:r}=await i(v(d));r!=null&&r.success&&h({reportId:r.report.reportId||"",reportName:r.report.name||"",reportCategory:r.report.classification||"",reportSource:r.report.source||"",reportYear:r.report.year||null,reportSummary:r.report.description||"",reportLink:r.report.link||"",pdf:""})}catch{m.error("فشل تحميل التقرير")}})()},[i,d]);const j=C().shape({reportId:l().required("مطلوب"),reportName:l().required("مطلوب"),reportCategory:l().required("مطلوب"),reportSource:l().required("مطلوب"),reportYear:D().required("مطلوب"),reportSummary:l().required("مطلوب"),reportLink:l().url("يجب أن يكون رابط صالح").required("مطلوب"),pdf:Y()}),N=async t=>{var s;f(!0);const r=new FormData;r.append("reportId",t.reportId),r.append("name",t.reportName),r.append("classification",t.reportCategory),r.append("source",t.reportSource),r.append("year",((s=t.reportYear)==null?void 0:s.toString())||""),r.append("description",t.reportSummary),r.append("link",t.reportLink),t.pdf&&r.append("pdf",t.pdf);try{const{payload:a}=await i(S({id:d,apiData:r}));if(a.success)m.success("تم التحديث بنجاح"),p(-1);else throw new Error(a.message||"خطأ أثناء التحديث")}catch(a){a instanceof Error?m.error(a.message):m.error("An unknown error occurred")}finally{f(!1)}};return c.useEffect(()=>{i(w("رفع التقارير"))},[]),e.jsxs("div",{className:"p-4 py-0",children:[e.jsx(q,{position:"top-right"}),e.jsx(E,{enableReinitialize:!0,initialValues:g,validationSchema:j,onSubmit:N,children:({setFieldValue:t,values:r})=>e.jsxs(I,{className:"space-y-6",children:[e.jsx("h2",{className:"font-bold text-main_color",children:"ادخل بيانات التقرير"}),e.jsxs("div",{className:"grid md:grid-cols-3 grid-cols-1 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"رقم التقرير"}),e.jsx(n,{type:"text",name:"reportId",className:"mt-1 block w-full bg-[#F7F8F9] p-2 rounded-lg border border-[#999999]"}),e.jsx(o,{name:"reportId",component:"div",className:"text-red-500 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"اسم التقرير"}),e.jsx(n,{type:"text",name:"reportName",className:"mt-1 block w-full bg-[#F7F8F9] p-2 rounded-lg border border-[#999999]"}),e.jsx(o,{name:"reportName",component:"div",className:"text-red-500 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"تصنيف التقرير"}),e.jsx(n,{type:"text",name:"reportCategory",className:"mt-1 block w-full bg-[#F7F8F9] p-2 rounded-lg border border-[#999999]"}),e.jsx(o,{name:"reportCategory",component:"div",className:"text-red-500 text-sm"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 grid-cols-1 gap-4",children:[e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium",children:"مصدر التقرير"}),e.jsx(n,{type:"text",name:"reportSource",className:"mt-1 block w-full bg-[#F7F8F9] p-2 rounded-lg border border-[#999999]"}),e.jsx(o,{name:"reportSource",component:"div",className:"text-red-500 text-sm"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{htmlFor:"reportYear",className:"block font-medium",children:"سنة التقرير"}),e.jsx(L,{selected:r.reportYear?new Date(r.reportYear,0):null,onChange:s=>t("reportYear",s?s.getFullYear():null),showYearPicker:!0,dateFormat:"yyyy",className:"w-full bg-[#F7F8F9] p-2 rounded-lg border border-[#999999]"}),e.jsx(o,{name:"reportYear",component:"div",className:"text-red-500 text-sm"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"نبذه عن التقرير"}),e.jsx(n,{as:"textarea",name:"reportSummary",className:"mt-1 block w-full bg-[#F7F8F9] p-2 rounded-lg border border-[#999999]"}),e.jsx(o,{name:"reportSummary",component:"div",className:"text-red-500 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"رابط التقرير الأساسي"}),e.jsx(n,{type:"text",name:"reportLink",className:"mt-1 block w-full bg-[#F7F8F9] p-2 rounded-lg border border-[#999999]",placeholder:"ادخل الرابط ..."}),e.jsx(o,{name:"reportLink",component:"div",className:"text-red-500 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"رفع الملفات"}),e.jsx("input",{type:"file",accept:".pdf",id:"file-upload",title:"رفع الملفات",className:"hidden",onChange:s=>{if(s.currentTarget.files&&s.currentTarget.files.length>0){const a=s.currentTarget.files[0];t("pdf",a),b(a.name)}}}),e.jsxs("label",{htmlFor:"file-upload",className:"mt-1 flex items-center justify-center w-full bg-[#F7F8F9] p-2 rounded-lg border border-[#999999] cursor-pointer hover:bg-gray-200 transition",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1M8 12l4-4m0 0l4 4m-4-4v12"})}),e.jsx("span",{className:"ml-2 text-gray-700",children:"رفع ملف PDF"})]}),x&&e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["الملف المحدد: ",x]}),e.jsx(o,{name:"pdf",component:"div",className:"text-red-500 text-sm mt-1"})]}),e.jsxs("div",{className:"flex col-span- items-center md:justify-end pb-3 sm:pb-4 justify-center gap-2",children:[e.jsx("button",{onClick:()=>p(-1),type:"submit",className:"text-black text-sm flex items-center gap-1 rounded-lg py-3 px-6 hover:bg-green-50 bg-[#EAF7E8] transition-colors",title:"الغاء",children:e.jsx("span",{className:"sm:inline pe-2",children:"الغاء"})}),e.jsx("button",{type:"submit",className:"px-4 flex items-cente py-2 bg-main_color text-white rounded-lg hover:bg-opacity-90 transition disabled:bg-gray-400 disabled:cursor-not-allowed",disabled:u,children:u?e.jsxs("span",{className:"flex items-center",children:[e.jsx("svg",{className:"animate-spin h-5 w-5 mr-2 border-t-2 border-white rounded-full",viewBox:"0 0 24 24"}),"جاري التحديث..."]}):e.jsxs("span",{className:"flex items-center",children:[e.jsx("img",{src:R,alt:"plus2",className:"w-4 h-4"}),"تحديث التقرير"]})})]})]})})]})};export{U as default};
