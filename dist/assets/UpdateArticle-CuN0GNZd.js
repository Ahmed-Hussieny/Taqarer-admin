import{b as k,a as A,u as E,r as c,g as C,f as R,j as e,F as S,G as q}from"./index-BKWFdLJF.js";import{R as L,C as U}from"./ClipLoader-1eirUGdC.js";/* empty css                   */import{i as I}from"./MainArticle-Cm6VgpXZ.js";import{p as P}from"./plus2-Cc0MLBo8.js";import{c as T,a as x,d as _,F as $,e as z,E as l,g as u}from"./index.esm-BO_zn8Fc.js";import{k as m}from"./index-Dy-D4uAd.js";const J=()=>{const{articleId:d}=k(),o=A(),g=E(),[b,p]=c.useState(null),[a,f]=c.useState(null),[j,N]=c.useState(""),w=T({image:_(),title:x().required("العنوان مطلوب"),description:x().required("الوصف مطلوب"),content:x().required("محتوى المقال مطلوب")}),y={toolbar:[[{header:[1,2,3,!1]},{font:[]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","image","video"],[{align:[]},{direction:"rtl"}],[{color:[]},{background:[]}],["clean"]]},F=async()=>{if(d){const t=(await o(S(d))).payload.article;if(t&&(f({image:t.image,title:t.title,description:t.description,content:t.content}),p(t.image||null),t.content))try{const r=await(await fetch(t.content)).text();N(r)}catch(n){console.error("Error fetching HTML content:",n),m.error("فشل في تحميل محتوى المقال")}}};c.useEffect(()=>{window.scrollTo(0,0),F(),o(C("تعديل المقالة")),o(R(3))},[]);const v=async(s,{setSubmitting:t})=>{const n=new FormData;n.append("title",s.title),n.append("description",s.description);const r=new File([s.content],"content.txt",{type:"text/plain"});n.append("contentFile",r),s.image instanceof File&&n.append("image",s.image);try{const i=await o(q({id:d,apiData:n}));console.log("Form values:",i),i.payload.success?(m.success("تم تعديل المقالة بنجاح"),g(-1)):m.error("فشلت عملية تعديل المقالة")}catch(i){console.error("Submission error:",i),m.error("حدث خطأ أثناء تعديل المقالة")}t(!1)};return e.jsx($,{enableReinitialize:!0,initialValues:{image:"",title:(a==null?void 0:a.title)||"",description:(a==null?void 0:a.description)||"",content:j||""},validationSchema:w,onSubmit:v,children:({setFieldValue:s,isSubmitting:t,values:n})=>e.jsxs(z,{children:[e.jsx("p",{className:"text-xl font-medium mb-2 text-black whitespace-nowrap",children:"تعديل مقالة"}),e.jsx("p",{className:"text-lg font-bold mb-2 text-main_color whitespace-nowrap",children:"ادخل بيانات المقالة"}),e.jsxs("div",{className:"bg-[#F7F8F9] p-2 items-center py-5 rounded-xl border mb-2 gap-3 grid md:grid-cols-5 grid-cols-1",children:[e.jsx("div",{className:"col-span-1 px-3",children:e.jsx("img",{src:b||I,alt:"Article",className:"h-28 w-32 object-cover rounded-lg"})}),e.jsxs("div",{className:"col-span-4",children:[e.jsxs("div",{className:"flex",children:[e.jsxs("label",{className:"bg-main_color text-white hover:opacity-90 border px-4 py-2 rounded-lg cursor-pointer",children:["تحميل صورة جديدة",e.jsx("input",{type:"file",name:"image",accept:"image/*",className:"hidden",onChange:r=>{var h;const i=(h=r.currentTarget.files)==null?void 0:h[0];i&&(s("image",i),p(URL.createObjectURL(i)))}})]}),e.jsx("button",{type:"button",className:"bg-[#EAF7E8] ms-2 text-main_color hover:opacity-90 border px-4 py-2 rounded-lg",onClick:()=>{s("image",null),p((a==null?void 0:a.image)||null)},children:"اعادة الضبط"})]}),e.jsx(l,{name:"image",component:"div",className:"text-red-500 text-sm"}),e.jsx("p",{className:"text-sm mt-2 text-slate-400 whitespace-nowrap",children:"مسموح ب jpg أو gif أو png. الحجم الأقصى 800 كيلوبايت"})]})]}),e.jsx("p",{className:"text-lg my-2 font-bold whitespace-nowrap",children:"عنوان المقالة"}),e.jsx(u,{type:"text",name:"title",className:"w-full mb-1 border bg-[#F7F8F9] p-2 rounded-lg",placeholder:"عنوان المقالة"}),e.jsx(l,{name:"title",component:"div",className:"text-red-500 text-sm mb-2"}),e.jsx("p",{className:"text-lg my-2 font-bold whitespace-nowrap",children:"وصف المقالة"}),e.jsx(u,{type:"text",name:"description",className:"w-full mb-1 border bg-[#F7F8F9] p-2 rounded-lg",placeholder:"وصف المقالة"}),e.jsx(l,{name:"description",component:"div",className:"text-red-500 text-sm mb-2"}),e.jsxs("p",{children:[e.jsx("span",{className:"text-lg my-2 font-bold whitespace-nowrap",children:"(المقال)"})," (ادخل محتوى المقال)"]}),e.jsx(L,{value:n.content,onChange:r=>s("content",r),modules:y,style:{direction:"rtl",textAlign:"center"},className:"mb-1"}),e.jsx(l,{name:"content",component:"div",className:"text-red-500 text-sm mb-3"}),e.jsxs("div",{className:"flex items-center md:justify-end pb-3 sm:pb-4 justify-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>g(-1),className:"text-black text-sm flex items-center gap-1 rounded-lg py-3 px-10 hover:bg-green-50 bg-[#EAF7E8] transition-colors",children:e.jsx("span",{className:"sm:inline pe-2",children:"الغاء"})}),e.jsx("button",{type:"submit",disabled:t,className:"text-white px-16 text-sm flex items-center gap-1 rounded-lg py-3 hover:bg-green-600 bg-[#3D9635] transition-colors",children:t?e.jsx(U,{color:"#ffffff",size:20}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:P,alt:"plus2",className:"w-4 h-4"}),e.jsx("span",{className:"sm:inline",children:"تعديل"})]})})]})]})})};export{J as default};
